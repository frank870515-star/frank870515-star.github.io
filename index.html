<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¢¨è¥¿å“¥å·¥å‚è¡Œæ”¿æœåŠ¡ä»ªè¡¨ç›˜</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
</head>
<body>
    <!-- ç™»å½•é¡µé¢ -->
    <div id="login-page" class="login-page">
        <div class="login-container">
            <h1 class="login-title" data-lang="login_title">å¢¨è¥¿å“¥å·¥å‚è¡Œæ”¿æœåŠ¡ä»ªè¡¨ç›˜</h1>
            <div class="login-form">
                <div class="form-group">
                    <label for="username" data-lang="username">è´¦å·</label>
                    <input type="text" id="username" placeholder="è¯·è¾“å…¥è´¦å·">
                </div>
                <div class="form-group">
                    <label for="password" data-lang="password">å¯†ç </label>
                    <input type="password" id="password" placeholder="è¯·è¾“å…¥å¯†ç ">
                </div>
                <button id="login-btn" class="login-btn" data-lang="login">ç™»å½•</button>
            </div>
        </div>
    </div>

    <!-- ä»ªè¡¨ç›˜é¡µé¢ -->
    <div id="dashboard-page" class="dashboard-page hidden">
        <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
        <header class="dashboard-header">
            <div class="header-left">
                <h1 data-lang="dashboard_title">å¢¨è¥¿å“¥å·¥å‚è¡Œæ”¿æœåŠ¡ä»ªè¡¨ç›˜</h1>
            </div>
            <div class="header-right">
                <button id="lang-switch" class="lang-switch" data-lang="lang_switch">åˆ‡æ¢è¯­è¨€</button>
                <button id="logout-btn" class="logout-btn" data-lang="logout">é€€å‡ºç™»å½•</button>
            </div>
        </header>

        <!-- ä½¿ç”¨æŒ‡å—æŠ˜å é¢æ¿ -->
        <div class="guide-section">
            <button id="guide-toggle" class="guide-toggle" data-lang="guide_title">ä½¿ç”¨æŒ‡å— â–¼</button>
            <div id="guide-content" class="guide-content hidden">
                <div class="guide-mxadmin" data-lang="guide_mxadmin">
                    <h3 data-lang="guide_mxadmin_title">å¢¨è¥¿å“¥å·¥å‚è¡Œæ”¿äººå‘˜æ“ä½œæŒ‡å—</h3>
                    <ol>
                        <li data-lang="guide_mxadmin_step1">ç‚¹å‡»ã€ŒExcelæ¨¡æ¿ä¸‹è½½ã€æŒ‰é’®è·å–ç©ºç™½æ¨¡æ¿</li>
                        <li data-lang="guide_mxadmin_step2">æŒ‰ç…§æ¨¡æ¿è¦æ±‚å¡«å†™æœˆåº¦è¡Œæ”¿æ•°æ®</li>
                        <li data-lang="guide_mxadmin_step3">ç‚¹å‡»ã€ŒExcelæ–‡ä»¶å¯¼å…¥ã€æŒ‰é’®ä¸Šä¼ å¡«å†™å¥½çš„Excelæ–‡ä»¶</li>
                        <li data-lang="guide_mxadmin_step4">ç³»ç»Ÿä¼šè‡ªåŠ¨æ ¡éªŒæ•°æ®æ ¼å¼ï¼Œå¦‚æœ‰é”™è¯¯è¯·æ ¹æ®æç¤ºä¿®æ­£</li>
                        <li data-lang="guide_mxadmin_step5">å¯¼å…¥æˆåŠŸåï¼Œä»ªè¡¨ç›˜ä¼šè‡ªåŠ¨åˆ·æ–°æ˜¾ç¤ºæœ€æ–°æ•°æ®</li>
                    </ol>
                </div>
                <div class="guide-hqadmin" data-lang="guide_hqadmin">
                    <h3 data-lang="guide_hqadmin_title">æ€»éƒ¨å‘˜å·¥æ“ä½œæŒ‡å—</h3>
                    <ol>
                        <li data-lang="guide_hqadmin_step1">ç™»å½•åå³å¯æŸ¥çœ‹å®æ—¶è¡Œæ”¿æ•°æ®ä»ªè¡¨ç›˜</li>
                        <li data-lang="guide_hqadmin_step2">ä½¿ç”¨ç­›é€‰åŠŸèƒ½æŸ¥çœ‹ç‰¹å®šæ—¶é—´æ®µçš„æ•°æ®</li>
                        <li data-lang="guide_hqadmin_step3">ç‚¹å‡»å›¾è¡¨å³ä¸Šè§’çš„ã€Œä¿å­˜ä¸ºå›¾ç‰‡ã€æŒ‰é’®ä¸‹è½½å›¾è¡¨</li>
                        <li data-lang="guide_hqadmin_step4">ç‚¹å‡»ã€Œå…¨é‡æ•°æ®ä¸‹è½½ã€æˆ–ã€Œç­›é€‰åæ•°æ®ä¸‹è½½ã€æŒ‰é’®ä¸‹è½½æ•°æ®æ–‡ä»¶</li>
                        <li data-lang="guide_hqadmin_step5">æ”¯æŒExcelå’ŒCSVä¸¤ç§æ ¼å¼ä¸‹è½½</li>
                    </ol>
                </div>
            </div>
        </div>

        <!-- æ“ä½œæŒ‰é’®åŒºåŸŸï¼ˆä»…mxadminå¯è§ï¼‰ -->
        <div id="action-buttons" class="action-buttons hidden">
            <button id="download-template-btn" class="btn btn-primary" data-lang="download_template">Excelæ¨¡æ¿ä¸‹è½½</button>
            <button id="import-excel-btn" class="btn btn-success" data-lang="import_excel">Excelæ–‡ä»¶å¯¼å…¥</button>
            <input type="file" id="excel-file-input" accept=".xlsx,.xls" style="display: none;">
        </div>



        <!-- æ•°æ®æ¦‚è§ˆå¡ç‰‡ -->
        <div class="overview-cards">
            <div class="card">
                <div class="card-icon">â­</div>
                <div class="card-content">
                    <h3 data-lang="satisfaction_score">æ»¡æ„åº¦è¯„åˆ†</h3>
                    <p id="satisfaction-score" class="card-value">-</p>
                </div>
            </div>
            <div class="card">
                <div class="card-icon">âœ…</div>
                <div class="card-content">
                    <h3 data-lang="sla_compliance">SLAåˆæ ¼ç‡</h3>
                    <p id="sla-compliance" class="card-value">-</p>
                </div>
            </div>
            <div class="card">
                <div class="card-icon">ğŸ‘¥</div>
                <div class="card-content">
                    <h3 data-lang="entry_rate">æˆåŠŸå…¥å¢ƒå æ¯”</h3>
                    <p id="entry-rate" class="card-value">-</p>
                </div>
            </div>
            <div class="card">
                <div class="card-icon">ğŸ’°</div>
                <div class="card-content">
                    <h3 data-lang="total_expenses">å››å¤§è´¹ç”¨åˆè®¡</h3>
                    <p id="total-expenses" class="card-value">-</p>
                </div>
            </div>
        </div>

        <!-- å›¾è¡¨åŒºåŸŸ -->
        <div class="charts-container">
            <div class="chart-row">
                <div class="chart-wrapper">
                    <div class="chart-header">
                        <h3 data-lang="satisfaction_sla_trend">æ»¡æ„åº¦ä¸SLAè¶‹åŠ¿</h3>
                        <button class="chart-download" data-chart="satisfaction-sla" data-lang="download_chart">ä¿å­˜ä¸ºå›¾ç‰‡</button>
                    </div>
                    <div id="satisfaction-sla-chart" class="chart"></div>
                </div>
                <div class="chart-wrapper">
                    <div class="chart-header">
                        <h3 data-lang="response_time_trend">å·¥å•å“åº”æ—¶é•¿è¶‹åŠ¿</h3>
                        <button class="chart-download" data-chart="response-time" data-lang="download_chart">ä¿å­˜ä¸ºå›¾ç‰‡</button>
                    </div>
                    <div id="response-time-chart" class="chart"></div>
                </div>
            </div>
            <div class="chart-row">
                <div class="chart-wrapper">
                    <div class="chart-header">
                        <h3 data-lang="expenses_trend">è´¹ç”¨è¶‹åŠ¿</h3>
                        <div class="chart-controls">
                            <button class="chart-control-btn active" data-view="monthly" data-lang="expenses_view_monthly">å•æœˆè¯¦æƒ…</button>
                            <button class="chart-control-btn" data-view="yearly" data-lang="expenses_view_yearly">å…¨å¹´è¶‹åŠ¿</button>
                        </div>
                        <button class="chart-download" data-chart="expenses" data-lang="download_chart">ä¿å­˜ä¸ºå›¾ç‰‡</button>
                    </div>
                    <div id="expenses-chart" class="chart"></div>
                </div>
                <div class="chart-wrapper">
                    <div class="chart-header">
                        <h3 data-lang="entry_ratio">æˆåŠŸå…¥å¢ƒå æ¯”</h3>
                        <button class="chart-download" data-chart="entry-ratio" data-lang="download_chart">ä¿å­˜ä¸ºå›¾ç‰‡</button>
                    </div>
                    <div id="entry-ratio-chart" class="chart"></div>
                </div>
            </div>
        </div>

        <!-- æ•°æ®è¡¨æ ¼ -->
        <div class="table-section">
            <div class="table-header">
                <h3 data-lang="data_table">æœˆåº¦æ•°æ®è¡¨æ ¼</h3>
                <div class="table-controls">
                    <button id="sort-asc-btn" class="btn btn-secondary" data-lang="sort_asc">å‡åºæ’åº</button>
                    <button id="sort-desc-btn" class="btn btn-secondary" data-lang="sort_desc">é™åºæ’åº</button>
                </div>
            </div>
            <div class="table-container">
                <table id="data-table" class="data-table">
                    <thead>
                        <tr>
                            <th data-lang="month">æœˆåº¦</th>
                            <th data-lang="satisfaction_score">æ»¡æ„åº¦è¯„åˆ†</th>
                            <th data-lang="response_time">å“åº”æ—¶é•¿(å°æ—¶)</th>
                            <th data-lang="accommodation">ä½å®¿è´¹ç”¨(MXN)</th>
                            <th data-lang="vehicle">ç”¨è½¦è´¹ç”¨(MXN)</th>
                            <th data-lang="catering">é¤é¥®è´¹ç”¨(MXN)</th>
                            <th data-lang="office">åŠå…¬è´¹ç”¨(MXN)</th>
                            <th data-lang="sla_compliance">SLAåˆæ ¼ç‡(%)</th>
                            <th data-lang="total_employees">æ€»äººæ•°</th>
                            <th data-lang="success_employees">æˆåŠŸäººæ•°</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td colspan="10" data-lang="no_data">æš‚æ— æ•°æ®</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- æ•°æ®ä¸‹è½½åŒºåŸŸ -->
        <div class="download-section">
            <button id="download-all-btn" class="btn btn-primary" data-lang="download_all">å…¨é‡æ•°æ®ä¸‹è½½</button>
            <button id="download-filtered-btn" class="btn btn-primary" data-lang="download_filtered">ç­›é€‰åæ•°æ®ä¸‹è½½</button>
            <div class="download-format">
                <label data-lang="download_format">ä¸‹è½½æ ¼å¼ï¼š</label>
                <select id="download-format">
                    <option value="xlsx" data-lang="format_excel">Excel (.xlsx)</option>
                    <option value="csv" data-lang="format_csv">CSV (.csv)</option>
                </select>
            </div>
        </div>
        <!-- æ•°æ®åŒæ­¥åŠŸèƒ½åŒºåŸŸ -->
        <div id="sync-section">
    <h3>æ•°æ®åŒæ­¥</h3>
    
    <!-- æ•°æ®è¾“å…¥åŒºåŸŸ -->
    <div class="data-input">
        <label for="user-data">ç”¨æˆ·æ•°æ®ï¼ˆæ–‡æœ¬/JSONï¼‰ï¼š</label>
        <textarea id="user-data" rows="5" placeholder="è¯·è¾“å…¥è¦åŒæ­¥çš„æ•°æ®..."></textarea>
    </div>
    
    <!-- æ“ä½œæŒ‰é’®åŒºåŸŸ -->
    <div class="sync-buttons">
        <button id="sync-upload">ä¸Šä¼ åŒæ­¥</button>
        <button id="sync-download">æ‹‰å–åŒæ­¥</button>
    </div>
    
    <!-- åŒæ­¥ç»“æœæç¤ºåŒºåŸŸ -->
    <div id="sync-message" class="sync-message"></div>
    
    <!-- æ•°æ®å±•ç¤ºåŒºåŸŸ -->
    <div class="data-display">
        <h4>åŒæ­¥æ•°æ®å±•ç¤ºï¼š</h4>
        <div id="sync-data-display" class="sync-data"></div>
    </div>
</div>

<!-- æ ·å¼ -->
<style>
#sync-section {
    max-width: 600px;
    margin: 20px auto;
    padding: 20px;
    border: 1px solid #ddd;
    border-radius: 8px;
    background-color: #f9f9f9;
}

.data-input {
    margin-bottom: 15px;
}

.data-input label {
    display: block;
    margin-bottom: 5px;
    font-weight: bold;
}

.data-input textarea {
    width: 100%;
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 4px;
    resize: vertical;
}

.sync-buttons {
    margin-bottom: 15px;
}

.sync-buttons button {
    padding: 10px 20px;
    margin-right: 10px;
    background-color: #4CAF50;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
}

.sync-buttons button:hover {
    background-color: #45a049;
}

.sync-buttons button:nth-child(2) {
    background-color: #2196F3;
}

.sync-buttons button:nth-child(2):hover {
    background-color: #0b7dda;
}

.sync-message {
    margin-bottom: 15px;
    padding: 10px;
    border-radius: 4px;
}

.sync-message.success {
    background-color: #d4edda;
    color: #155724;
    border: 1px solid #c3e6cb;
}

.sync-message.error {
    background-color: #f8d7da;
    color: #721c24;
    border: 1px solid #f5c6cb;
}

.data-display {
    margin-top: 20px;
}

.data-display h4 {
    margin-bottom: 10px;
}

.sync-data {
    padding: 15px;
    background-color: #fff;
    border: 1px solid #ddd;
    border-radius: 4px;
    white-space: pre-wrap;
    font-family: monospace;
}
</style>
    </div>

    <!-- æ¨¡æ€æ¡† -->
    <div id="modal" class="modal hidden">
        <div class="modal-content">
            <span class="modal-close">&times;</span>
            <h2 id="modal-title" data-lang="modal_title">æç¤º</h2>
            <p id="modal-message"></p>
            <div class="modal-buttons">
                <button id="modal-confirm" class="btn btn-primary" data-lang="confirm">ç¡®è®¤</button>
                <button id="modal-cancel" class="btn btn-secondary" data-lang="cancel">å–æ¶ˆ</button>
            </div>
        </div>
    </div>

    <script src="utils.js"></script>
    <script src="script.js"></script>
    <script>
    // --------------------------
// é…ç½®é¡¹ï¼ˆè¯·æ ¹æ®å®é™…æƒ…å†µä¿®æ”¹ï¼‰
// --------------------------
const CONFIG = {
    GIST_ID: '383e3810b45b4339e79499d298f17acb',          // ä»æ–°Gisté“¾æ¥è·å–çš„ID
    GITHUB_TOKEN: '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', // æ–°ç”Ÿæˆçš„GitHubä»¤ç‰Œ
    PAGES_URL: 'https://frank870515-star.github.io/',       // GitHub Pagesè®¿é—®é“¾æ¥
    GIST_FILENAME: 'sync-data.json',   // Gistæ–‡ä»¶åï¼Œä¸åˆ›å»ºæ—¶ä¿æŒä¸€è‡´
    LOCAL_STORAGE_KEY: 'gist_sync_data' // æœ¬åœ°ç¼“å­˜é”®å
};

// --------------------------
// GitHub Gist APIè¯·æ±‚å·¥å…·
// --------------------------
class GistSyncAPI {
    constructor(config) {
        this.config = config;
    }
    
    // å‘é€APIè¯·æ±‚
    async request(url, options = {}) {
        try {
            const headers = {
                'Authorization': `token ${this.config.GITHUB_TOKEN}`,
                'Accept': 'application/vnd.github.v3+json',
                ...options.headers
            };
            
            const response = await fetch(url, {
                ...options,
                headers
            });
            
            if (!response.ok) {
                // è·å–è¯¦ç»†é”™è¯¯ä¿¡æ¯
                let errorMsg = `APIè¯·æ±‚å¤±è´¥: ${response.status} ${response.statusText}`;
                try {
                    const errorData = await response.json();
                    if (errorData.message) {
                        errorMsg += ` - ${errorData.message}`;
                    }
                    if (errorData.documentation_url) {
                        errorMsg += ` (${errorData.documentation_url})`;
                    }
                } catch (e) {
                    // å¦‚æœæ— æ³•è§£æJSONï¼Œä½¿ç”¨é»˜è®¤é”™è¯¯ä¿¡æ¯
                }
                throw new Error(errorMsg);
            }
            
            return response.json();
        } catch (error) {
            // å¤„ç†ç½‘ç»œé”™è¯¯æˆ–å…¶ä»–å¼‚å¸¸
            if (error.name === 'TypeError' && error.message.includes('Failed to fetch')) {
                throw new Error('ç½‘ç»œè¯·æ±‚å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–ç¨åé‡è¯•');
            }
            throw error;
        }
    }
    
    // è·å–Gistæ•°æ®
    async getGist() {
        const url = `https://api.github.com/gists/${this.config.GIST_ID}`;
        return await this.request(url);
    }
    
    // æ›´æ–°Gistæ•°æ®
    async updateGist(content) {
        const url = `https://api.github.com/gists/${this.config.GIST_ID}`;
        const data = {
            files: {
                [this.config.GIST_FILENAME]: {
                    content: JSON.stringify(content, null, 2) // æ ¼å¼åŒ–JSONï¼Œä¾¿äºæŸ¥çœ‹
                }
            }
        };
        
        return await this.request(url, {
            method: 'PATCH',
            body: JSON.stringify(data)
        });
    }
}

// --------------------------
// æ•°æ®åŒæ­¥ç®¡ç†å™¨
// --------------------------
class DataSyncManager {
    constructor(config) {
        this.config = config;
        this.api = new GistSyncAPI(config);
    }
    
    // ä»æœ¬åœ°ç¼“å­˜è¯»å–æ•°æ®
    getLocalData() {
        try {
            const data = localStorage.getItem(this.config.LOCAL_STORAGE_KEY);
            return data ? JSON.parse(data) : null;
        } catch (error) {
            console.error('è¯»å–æœ¬åœ°ç¼“å­˜å¤±è´¥:', error);
            return null;
        }
    }
    
    // ä¿å­˜æ•°æ®åˆ°æœ¬åœ°ç¼“å­˜
    saveLocalData(data) {
        try {
            localStorage.setItem(this.config.LOCAL_STORAGE_KEY, JSON.stringify(data));
        } catch (error) {
            console.error('ä¿å­˜æœ¬åœ°ç¼“å­˜å¤±è´¥:', error);
        }
    }
    
    // ä¸Šä¼ åŒæ­¥æ•°æ®
    async uploadData(userData) {
        try {
            // æ•°æ®æ ¼å¼æ ¡éªŒå’Œå¤„ç†
            let processedUserData = userData;
            if (userData.trim()) {
                try {
                    processedUserData = JSON.parse(userData);
                } catch (e) {
                    // éJSONæ ¼å¼ï¼Œä½œä¸ºæ–‡æœ¬å¤„ç†
                    // ç§»é™¤é¦–å°¾ç©ºç™½å­—ç¬¦
                    processedUserData = userData.trim();
                }
            }
            
            // æ„å»ºåŒæ­¥æ•°æ®ï¼Œç¡®ä¿æ ¼å¼å®Œæ•´
            const syncData = {
                pagesUrl: this.config.PAGES_URL || '',
                userData: processedUserData || '',
                lastSyncTime: new Date().toISOString(),
                syncVersion: '1.0' // æ·»åŠ ç‰ˆæœ¬å·ï¼Œä¾¿äºåç»­æ‰©å±•
            };
            
            // æ›´æ–°Gist
            const response = await this.api.updateGist(syncData);
            
            // éªŒè¯æ›´æ–°ç»“æœ
            if (response && response.files && response.files[this.config.GIST_FILENAME]) {
                // æ›´æ–°æœ¬åœ°ç¼“å­˜
                this.saveLocalData(syncData);
                return { success: true, data: syncData };
            } else {
                throw new Error('Gistæ›´æ–°å¤±è´¥ï¼Œè¿”å›ç»“æœå¼‚å¸¸');
            }
        } catch (error) {
            console.error('ä¸Šä¼ åŒæ­¥å¤±è´¥:', error);
            // ä¿ç•™æœ¬åœ°ç¼“å­˜ï¼Œé¿å…æ•°æ®ä¸¢å¤±
            return { success: false, error: error.message };
        }
    }
    
    // æ‹‰å–åŒæ­¥æ•°æ®
    async downloadData() {
        try {
            // è·å–Gistæ•°æ®
            const gist = await this.api.getGist();
            
            // æ£€æŸ¥Gistæ–‡ä»¶æ˜¯å¦å­˜åœ¨
            if (!gist.files || !gist.files[this.config.GIST_FILENAME]) {
                throw new Error(`Gistæ–‡ä»¶ ${this.config.GIST_FILENAME} ä¸å­˜åœ¨`);
            }
            
            const fileContent = gist.files[this.config.GIST_FILENAME].content;
            const syncData = JSON.parse(fileContent);
            
            // ç¡®ä¿è¿”å›çš„æ•°æ®æ ¼å¼å®Œæ•´
            const processedData = {
                pagesUrl: syncData.pagesUrl || this.config.PAGES_URL || '',
                userData: syncData.userData || '',
                lastSyncTime: syncData.lastSyncTime || new Date().toISOString(),
                syncVersion: syncData.syncVersion || '1.0'
            };
            
            // æ›´æ–°æœ¬åœ°ç¼“å­˜
            this.saveLocalData(processedData);
            
            return { success: true, data: processedData };
        } catch (error) {
            console.error('æ‹‰å–åŒæ­¥å¤±è´¥:', error);
            // æ‹‰å–å¤±è´¥æ—¶ï¼Œè¿”å›æœ¬åœ°ç¼“å­˜æ•°æ®ï¼ˆå¦‚æœæœ‰ï¼‰
            const localData = this.getLocalData();
            if (localData) {
                return { 
                    success: false, 
                    error: `${error.message}ï¼Œå·²åŠ è½½æœ¬åœ°ç¼“å­˜æ•°æ®`,
                    data: localData 
                };
            }
            return { success: false, error: error.message };
        }
    }
}

// --------------------------
// é¡µé¢äº¤äº’é€»è¾‘
// --------------------------
class SyncUI {
    constructor(syncManager) {
        this.syncManager = syncManager;
        this.initEventListeners();
        this.loadLocalData();
    }
    
    // åˆå§‹åŒ–äº‹ä»¶ç›‘å¬å™¨
    initEventListeners() {
        // ä¸Šä¼ åŒæ­¥æŒ‰é’®ç‚¹å‡»äº‹ä»¶
        document.getElementById('sync-upload').addEventListener('click', async () => {
            const userData = document.getElementById('user-data').value;
            await this.handleUpload(userData);
        });
        
        // æ‹‰å–åŒæ­¥æŒ‰é’®ç‚¹å‡»äº‹ä»¶
        document.getElementById('sync-download').addEventListener('click', async () => {
            await this.handleDownload();
        });
    }
    
    // åŠ è½½æœ¬åœ°ç¼“å­˜æ•°æ®
    loadLocalData() {
        const localData = this.syncManager.getLocalData();
        if (localData) {
            this.displaySyncData(localData);
        }
    }
    
    // å¤„ç†ä¸Šä¼ åŒæ­¥
    async handleUpload(userData) {
        // ç¦ç”¨æŒ‰é’®ï¼Œé˜²æ­¢é‡å¤ç‚¹å‡»
        this.toggleButtons(false);
        this.showMessage('æ­£åœ¨ä¸Šä¼ åŒæ­¥...', 'info');
        
        const result = await this.syncManager.uploadData(userData);
        
        if (result.success) {
            this.showMessage('ä¸Šä¼ åŒæ­¥æˆåŠŸï¼', 'success');
            this.displaySyncData(result.data);
        } else {
            this.showMessage(`ä¸Šä¼ åŒæ­¥å¤±è´¥ï¼š${result.error}`, 'error');
        }
        
        // å¯ç”¨æŒ‰é’®
        this.toggleButtons(true);
    }
    
    // å¤„ç†æ‹‰å–åŒæ­¥
    async handleDownload() {
        // ç¦ç”¨æŒ‰é’®ï¼Œé˜²æ­¢é‡å¤ç‚¹å‡»
        this.toggleButtons(false);
        this.showMessage('æ­£åœ¨æ‹‰å–åŒæ­¥...', 'info');
        
        const result = await this.syncManager.downloadData();
        
        if (result.success) {
            this.showMessage('æ‹‰å–åŒæ­¥æˆåŠŸï¼', 'success');
            this.displaySyncData(result.data);
            // æ‹‰å–æˆåŠŸåï¼Œå°†æ•°æ®å¡«å……åˆ°è¾“å…¥æ¡†
            this.fillUserDataInput(result.data.userData);
        } else {
            this.showMessage(`æ‹‰å–åŒæ­¥å¤±è´¥ï¼š${result.error}`, 'error');
        }
        
        // å¯ç”¨æŒ‰é’®
        this.toggleButtons(true);
    }
    
    // æ˜¾ç¤ºåŒæ­¥æ¶ˆæ¯
    showMessage(message, type) {
        const messageEl = document.getElementById('sync-message');
        messageEl.textContent = message;
        messageEl.className = `sync-message ${type}`;
        
        // è‡ªåŠ¨æ¸…é™¤æ¶ˆæ¯ï¼ˆæˆåŠŸæ¶ˆæ¯3ç§’åæ¸…é™¤ï¼Œé”™è¯¯æ¶ˆæ¯5ç§’åæ¸…é™¤ï¼‰
        const timeout = type === 'error' ? 5000 : 3000;
        setTimeout(() => {
            if (messageEl.textContent === message) {
                messageEl.textContent = '';
                messageEl.className = 'sync-message';
            }
        }, timeout);
    }
    
    // æ˜¾ç¤ºåŒæ­¥æ•°æ®
    displaySyncData(data) {
        const displayEl = document.getElementById('sync-data-display');
        displayEl.textContent = JSON.stringify(data, null, 2);
    }
    
    // å¡«å……ç”¨æˆ·æ•°æ®è¾“å…¥æ¡†
    fillUserDataInput(userData) {
        const inputEl = document.getElementById('user-data');
        if (typeof userData === 'string') {
            inputEl.value = userData;
        } else {
            inputEl.value = JSON.stringify(userData, null, 2);
        }
    }
    
    // ç¦ç”¨/å¯ç”¨æŒ‰é’®
    toggleButtons(disabled) {
        document.getElementById('sync-upload').disabled = !disabled;
        document.getElementById('sync-download').disabled = !disabled;
    }
}

// --------------------------
// åˆå§‹åŒ–åº”ç”¨
// --------------------------
document.addEventListener('DOMContentLoaded', () => {
    // åˆ›å»ºæ•°æ®åŒæ­¥ç®¡ç†å™¨
    const syncManager = new DataSyncManager(CONFIG);
    
    // åˆå§‹åŒ–UI
    new SyncUI(syncManager);
});
    </script>
</body>
</html>